<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="refresh" content="60" >
  <title><%= title %></title>
  <link rel="stylesheet" href="css/index.css">

</head>
<body>
  <% var now = moment();
     var busyNow = function (fb) { return now.isAfter(fb.start) && now.isBefore(fb.end); };
  %>
  <h2><%= title %></h2>
  <h5><%= moment().format('dddd, MMMM Do') %></h5>
  <div id="rooms">
    <div class="row">
    <% rooms.sort(function (a,b) { return a.id > b.id; }).forEach(function(room, index) { %>
      <div class="room <%= room.id %> <%= room.freebusy.some(busyNow)? "busy" : "" %>">
        <span class="name"><%= room.name %></span>
        <% room.freebusy.some(function(fb){ %>
          <% if (now.isAfter(fb.start) && now.isBefore(fb.end)) { %>
            <span class="fb">free <%= timeOrFromNow(fb.end) %></span>
            <% return true; %>
          <% } else { %>
            <% if (now.isBefore(fb.end)) { %>
              <span class="fb">busy <%= timeOrFromNow(fb.start) %></span>
              <% return true; %>
            <% } %>
          <% } %>
        <% return false; %>
        <% }) %>
      </div>
      <% if (index === 3 || index === 7) { %> </div><div class="row"> <% } %>
    <% }) %>
    </div>
  </div>

</body>
</html>
